(()=>{"use strict";function e(e,t,a){const n=new Date,s=document.querySelector(".js-month"),r=document.querySelectorAll(".calendar__item"),i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];0!==a&&n.setDate((new Date).getDate()+a),r.forEach((e=>e.remove()));for(let e=(n.setDate(n.getDate()-n.getDay()+1),Date.parse(n));e<=(n.setDate(n.getDate()-n.getDay()+(n.getDay()?7:0)),Date.parse(n));e+=864e5)t.innerHTML+=`\n      <div class="calendar__item weekdays__${new Date(e).getDay()}">\n                  <h4 class = "weekdays__item">${i[new Date(e).getDay()]}</h4>\n                  <h4 class="calendar__date">${new Date(e).toLocaleDateString().slice(0,5)}</h4>\n                  <div class="calendar__user-fields">\n                  </div>\n              </div>\n      `,s.innerHTML=`<h3>${new Date(e).toLocaleString("en",{month:"long"})}</h3>`;const l=document.querySelectorAll(".calendar__user-fields");Array.from(l).map((t=>{let a=1;for(;a<=e;)t.innerHTML+=`<p data-count=${a} data-date=${t.previousElementSibling.innerHTML} class = 'date-${t.previousElementSibling.innerHTML} cell cell--${a++} drop'></p>`;t.setAttribute("data-date",`${t.previousElementSibling.innerHTML}`)}))}const t=localStorage.getItem("items")?[]:JSON.parse(localStorage.getItem("items"));function a(e){const a=document.querySelectorAll(".task__element"),n=document.querySelectorAll(".cell"),s=document.querySelectorAll(".users__item");let r=null,i=null;function l(e){e.dataTransfer.setData("dragItem",this.dataset.id),r=this,setTimeout((()=>{this.classList.add("hide")}),0)}function d(){this.classList.remove("hide"),r=null}function o(e){e.preventDefault(),this.childNodes.length<=2&&this.classList.remove("overflow-scroll")}function c(e){e.preventDefault(),this.classList.add("hovered"),i=this,this.childNodes.length<=2&&this.classList.remove("overflow-scroll")}function u(){this.classList.remove("hovered"),i=this,this.childNodes.length<=2&&this.classList.remove("overflow-scroll")}function h(){this.append(r),this.childNodes.length>2&&this.classList.add("overflow-scroll"),console.log(this.getAttribute("data-date"),this.getAttribute("data-count"));const e={date:this.getAttribute("data-date"),position:this.getAttribute("data-count")};t.push(e),localStorage.setItem("items",JSON.stringify(t)),this.classList.remove("hovered")}function g(a){const n=this.getAttribute("data-user-id"),s=[];for(let t=0;t<e.length;t++){let t=e[n].planStartDate.replace(/-/gi,".").slice(5,10),a=t.slice(3,5)+"."+t.slice(0,2);const i=document.querySelector(`[data-date='${a}']`).querySelector(`[data-count='${n}']`);i.append(r),i.childNodes.length>2&&i.classList.add("overflow-scroll"),this.classList.remove("hovered"),s.push(i)}for(let e=0;e<s.length-24;e++){console.log(s[e].getAttribute("data-date"),s[e].getAttribute("data-count"));const a={date:s[e].getAttribute("data-date"),position:s[e].getAttribute("data-count")};t.push(a),localStorage.setItem("items",JSON.stringify(t))}}s.forEach((e=>{e.addEventListener("dragover",o),e.addEventListener("dragenter",c),e.addEventListener("dragleave",u),e.addEventListener("drop",g)})),n.forEach((e=>{e.addEventListener("dragover",o),e.addEventListener("dragenter",c),e.addEventListener("dragleave",u),e.addEventListener("drop",h)})),a.forEach((e=>{e.addEventListener("dragstart",l),e.addEventListener("dragend",d),e.addEventListener("dragenter",(()=>{r!==i&&(i=e)})),e.addEventListener("dragleave",(()=>{i=null}))}))}const n=document.querySelector(".js-backlog__content");function s(e,t){const a=document.querySelectorAll(".cell");e.map((e=>{if(null!==e.executor)for(let n=0;n<t.length;n++)if(t[n].id===e.executor){let s=e.planStartDate.replace(/-/gi,".").slice(5,10),r=s.slice(3,5)+"."+s.slice(0,2);a.forEach((a=>{if(a.getAttribute("data-date")===r&&+a.getAttribute("data-count")===t[n].id){const t=document.createElement("div");t.setAttribute("draggable","true"),t.setAttribute("data-id",`${e.id}`),t.classList.add("task__element"),a.appendChild(t),t.innerHTML+=`<p class="task__description"   data-tooltip="Start:${e.planStartDate} Deadline:${e.planEndDate}">${e.subject}</p>`}}))}}))}let r=0;const i=document.querySelector(".js-users"),l=document.querySelector(".js-calendar__container");!async function(){const t=(await async function(){try{let e=await fetch("https://varankin_dev.elma365.ru/api/extensions/2a38760e-083a-4dd0-aebc-78b570bfd3c7/script/users");return await e.json()}catch(e){console.error(e)}}()).map((e=>(i.innerHTML+=`\n                <div class="users__item" data-user-id= ${e.id}>\n                            <h4 class="users__title" >${e.surname} ${e.firstName}</h4>\n                        </div>\n                `,{id:e.id,surname:e.surname,name:e.firstName})));!function(t,a){document.querySelector(".js-button--next").addEventListener("click",(()=>{r+=7,e(t,a,r)})),document.querySelector(".js-button--back").addEventListener("click",(()=>{r-=7,e(t,a,r)}))}(t.length,l),e(t.length,l,r),(async e=>{const t=document.querySelectorAll(".cell"),r=await(async()=>{try{let e=await fetch("https://varankin_dev.elma365.ru/api/extensions/2a38760e-083a-4dd0-aebc-78b570bfd3c7/script/tasks");return await e.json()}catch(e){console.error(e)}})(),i=[],l=(new Date).toLocaleDateString().slice(0,5);console.log(l),r.map((e=>{i.push(e)})),s(i,e),function(e){e.map((e=>{null===e.executor&&(n.innerHTML+=`\n            <div class="task__element" draggable="true" data-id="${e.id}">\n                <p class="task__description"  data-tooltip="Start:${e.planStartDate} Deadline:${e.planEndDate}">${e.subject}</p>\n            </div>\n            `)}))}(i),a(i),document.querySelectorAll(".js-header__button").forEach((t=>{t.addEventListener("click",(()=>{document.querySelectorAll(".cell").forEach((e=>{e.getAttribute("data-date")===l&&e.classList.add("today")})),s(i,e),a(i)}))})),t.forEach((e=>{e.getAttribute("data-date")===l&&e.classList.add("today")}))})(t)}()})();