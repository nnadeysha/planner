(()=>{"use strict";function e(e,t,a){const n=new Date,r=document.querySelector(".month"),s=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];0!==a&&n.setDate((new Date).getDate()+a),document.querySelectorAll(".calendar__item").forEach((e=>e.remove()));for(let e=(n.setDate(n.getDate()-n.getDay()+1),Date.parse(n));e<=(n.setDate(n.getDate()-n.getDay()+(n.getDay()?7:0)),Date.parse(n));e+=864e5)t.innerHTML+=`\n      <div class="calendar__item weekdays__${new Date(e).getDay()}">\n                  <h4 class = "weekdays__item">${s[new Date(e).getDay()]}</h4>\n                  <h4 class="calendar__date">${new Date(e).toLocaleDateString().slice(0,5)}</h4>\n                  <div class="calendar__user-fields">\n                  </div>\n              </div>\n      `,r.innerHTML=`<h3>${new Date(e).toLocaleString("en",{month:"long"})}</h3>`;const i=document.querySelectorAll(".calendar__user-fields");Array.from(i).map((t=>{let a=1;for(;a<=e;)t.innerHTML+=`<p data-count=${a} data-date=${t.previousElementSibling.innerHTML} class = 'date-${t.previousElementSibling.innerHTML} cell cell--${a++} drop'></p>`;t.setAttribute("data-date",`${t.previousElementSibling.innerHTML}`)}))}const t=localStorage.getItem("items")?[]:JSON.parse(localStorage.getItem("items"));function a(e){const a=document.querySelectorAll(".task__element"),n=document.querySelectorAll(".cell"),r=document.querySelectorAll(".users__item");let s=null,i=null;function d(e){e.dataTransfer.setData("dragItem",this.dataset.id),s=this,setTimeout((()=>{this.classList.add("hide")}),0)}function l(){this.classList.remove("hide"),s=null}function c(e){e.preventDefault()}function o(e){e.preventDefault(),this.classList.add("hovered"),i=this}function u(){this.classList.remove("hovered"),i=this}function m(){this.append(s),console.log(this.getAttribute("data-date"),this.getAttribute("data-count"));const e={date:this.getAttribute("data-date"),position:this.getAttribute("data-count")};t.push(e),localStorage.setItem("items",JSON.stringify(t)),console.log(t),console.log(s),this.classList.remove("hovered")}function g(t){const a=this.getAttribute("data-user-id");for(let t=0;t<e.length;t++){let t=e[a].planStartDate.replace(/-/gi,".").slice(5,10),n=t.slice(3,5)+"."+t.slice(0,2);document.querySelector(`[data-date='${n}']`).querySelector(`[data-count='${a}']`).append(s)}this.classList.remove("hovered")}r.forEach((e=>{e.addEventListener("dragover",c),e.addEventListener("dragenter",o),e.addEventListener("dragleave",u),e.addEventListener("drop",g)})),n.forEach((e=>{e.addEventListener("dragover",c),e.addEventListener("dragenter",o),e.addEventListener("dragleave",u),e.addEventListener("drop",m)})),a.forEach((e=>{e.addEventListener("dragstart",d),e.addEventListener("dragend",l),e.addEventListener("dragenter",(()=>{s!==i&&(i=e)})),e.addEventListener("dragleave",(()=>{i=null}))}))}const n=document.querySelector(".backlog__content");function r(e,t,a){const n=document.querySelectorAll(".cell");e.map((e=>{for(let a=0;a<t.length;a++)if(t[a].id===e.executor){let r=e.planStartDate.replace(/-/gi,".").slice(5,10),s=r.slice(3,5)+"."+r.slice(0,2);n.forEach((n=>{if(n.getAttribute("data-date")===s&&+n.getAttribute("data-count")===t[a].id){const t=document.createElement("div");t.setAttribute("draggable","true"),t.setAttribute("data-id",`${e.id}`),t.classList.add("task__element"),n.appendChild(t),t.innerHTML+=`<p class="task__description"   data-tooltip="Start:${e.planStartDate} Deadline:${e.planEndDate}">${e.subject}</p>`}}))}}))}let s=0;const i=document.querySelector(".users"),d=document.querySelector(".calendar__container");!async function(){const t=(await async function(){try{let e=await fetch("https://varankin_dev.elma365.ru/api/extensions/2a38760e-083a-4dd0-aebc-78b570bfd3c7/script/users");return await e.json()}catch(e){console.error(e)}}()).map((e=>(i.innerHTML+=`\n                <div class="users__item" data-user-id= ${e.id}>\n                            <h4 class="users__title" >${e.surname} ${e.firstName}</h4>\n                        </div>\n                `,{id:e.id,surname:e.surname,name:e.firstName})));console.log(t),function(t,a,n){document.getElementById("nextButton").addEventListener("click",(()=>{s+=7,e(t,a,s)})),document.getElementById("backButton").addEventListener("click",(()=>{s-=7,e(t,a,s)}))}(t.length,d),e(t.length,d,s),(async e=>{const t=await(async()=>{try{let e=await fetch("https://varankin_dev.elma365.ru/api/extensions/2a38760e-083a-4dd0-aebc-78b570bfd3c7/script/tasks");return await e.json()}catch(e){console.error(e)}})(),s=[];t.map((e=>{s.push(e)})),r(s,e),function(e){e.map((e=>{null===e.executor&&(n.innerHTML+=`\n            <div class="task__element" draggable="true" data-id="${e.id}">\n                <p class="task__description"  data-tooltip="Start:${e.planStartDate} Deadline:${e.planEndDate}">Task:${e.subject}</p>\n            </div>\n            `)}))}(s),a(s),document.querySelectorAll(".header__button").forEach((t=>{t.addEventListener("click",(()=>{a(s),r(s,e)}))}))})(t)}()})();