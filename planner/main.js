(()=>{"use strict";function e(e,t,a){const n=new Date,s=document.querySelector(".js-month"),r=document.querySelectorAll(".calendar__item"),l=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];0!==a&&n.setDate((new Date).getDate()+a),r.forEach((e=>e.remove()));for(let e=(n.setDate(n.getDate()-n.getDay()+1),Date.parse(n));e<=(n.setDate(n.getDate()-n.getDay()+(n.getDay()?7:0)),Date.parse(n));e+=864e5)t.innerHTML+=`\n      <div class="calendar__item weekdays__${new Date(e).getDay()}">\n                  <h4 class = "weekdays__item">${l[new Date(e).getDay()]}</h4>\n                  <h4 class="calendar__date">${new Date(e).toLocaleDateString().slice(0,5)}</h4>\n                  <div class="calendar__user-fields">\n                  </div>\n              </div>\n      `,s.innerHTML=`<h3>${new Date(e).toLocaleString("en",{month:"long"})}</h3>`;const d=document.querySelectorAll(".calendar__user-fields");Array.from(d).map((t=>{let a=1;for(;a<=e;)t.innerHTML+=`<p data-count=${a} data-date=${t.previousElementSibling.innerHTML} class = 'date-${t.previousElementSibling.innerHTML} cell cell--${a++} drop'></p>`;t.setAttribute("data-date",`${t.previousElementSibling.innerHTML}`)}))}const t=localStorage.getItem("items")?[]:JSON.parse(localStorage.getItem("items"));function a(e){const a=document.querySelectorAll(".task__element"),n=document.querySelectorAll(".cell"),s=document.querySelectorAll(".users__item");let r=null,l=null;function d(e){e.dataTransfer.setData("dragItem",this.dataset.id),r=this,setTimeout((()=>{this.classList.add("hide")}),0)}function i(){this.classList.remove("hide"),r=null}function c(e){e.preventDefault(),this.childNodes.length<=2&&this.classList.remove("overflow-scroll")}function o(e){e.preventDefault(),this.classList.add("hovered"),l=this,this.childNodes.length<=2&&this.classList.remove("overflow-scroll")}function u(){this.classList.remove("hovered"),l=this,this.childNodes.length<=2&&this.classList.remove("overflow-scroll")}function h(){this.append(r),this.childNodes.length>2&&this.classList.add("overflow-scroll"),console.log(this.getAttribute("data-date"),this.getAttribute("data-count"));const e={date:this.getAttribute("data-date"),position:this.getAttribute("data-count")};t.push(e),localStorage.setItem("items",JSON.stringify(t)),console.log(t),console.log(r),n.forEach((e=>{e.classList.remove("hovered")}))}function g(t){const a=this.getAttribute("data-user-id");for(let t=0;t<e.length;t++){let t=e[a].planStartDate.replace(/-/gi,".").slice(5,10),n=t.slice(3,5)+"."+t.slice(0,2);const s=document.querySelector(`[data-date='${n}']`).querySelector(`[data-count='${a}']`);s.append(r),s.childNodes.length>2&&s.classList.add("overflow-scroll")}}s.forEach((e=>{e.addEventListener("dragover",c),e.addEventListener("dragenter",o),e.addEventListener("dragleave",u),e.addEventListener("drop",g)})),n.forEach((e=>{e.addEventListener("dragover",c),e.addEventListener("dragenter",o),e.addEventListener("dragleave",u),e.addEventListener("drop",h)})),a.forEach((e=>{e.addEventListener("dragstart",d),e.addEventListener("dragend",i),e.addEventListener("dragenter",(()=>{r!==l&&(l=e)})),e.addEventListener("dragleave",(()=>{l=null}))}))}const n=document.querySelector(".js-backlog__content");function s(e,t){const a=document.querySelectorAll(".cell");e.map((e=>{if(null!==e.executor)for(let n=0;n<t.length;n++)if(t[n].id===e.executor){let s=e.planStartDate.replace(/-/gi,".").slice(5,10),r=s.slice(3,5)+"."+s.slice(0,2);a.forEach((a=>{if(a.getAttribute("data-date")===r&&+a.getAttribute("data-count")===t[n].id){const t=document.createElement("div");t.setAttribute("draggable","true"),t.setAttribute("data-id",`${e.id}`),t.classList.add("task__element"),a.appendChild(t),t.innerHTML+=`<p class="task__description"   data-tooltip="Start:${e.planStartDate} Deadline:${e.planEndDate}">${e.subject}</p>`}}))}}))}let r=0;const l=document.querySelector(".js-users"),d=document.querySelector(".js-calendar__container");!async function(){const t=(await async function(){try{let e=await fetch("https://varankin_dev.elma365.ru/api/extensions/2a38760e-083a-4dd0-aebc-78b570bfd3c7/script/users");return await e.json()}catch(e){console.error(e)}}()).map((e=>(l.innerHTML+=`\n                <div class="users__item" data-user-id= ${e.id}>\n                            <h4 class="users__title" >${e.surname} ${e.firstName}</h4>\n                        </div>\n                `,{id:e.id,surname:e.surname,name:e.firstName})));!function(t,a){document.querySelector(".js-button--next").addEventListener("click",(()=>{r+=7,e(t,a,r)})),document.querySelector(".js-button--back").addEventListener("click",(()=>{r-=7,e(t,a,r)}))}(t.length,d),e(t.length,d,r),(async e=>{const t=document.querySelectorAll(".cell"),r=await(async()=>{try{let e=await fetch("https://varankin_dev.elma365.ru/api/extensions/2a38760e-083a-4dd0-aebc-78b570bfd3c7/script/tasks");return await e.json()}catch(e){console.error(e)}})(),l=[],d=(new Date).toLocaleDateString().slice(0,5);console.log(d),r.map((e=>{l.push(e)})),s(l,e),function(e){e.map((e=>{null===e.executor&&(n.innerHTML+=`\n            <div class="task__element" draggable="true" data-id="${e.id}">\n                <p class="task__description"  data-tooltip="Start:${e.planStartDate} Deadline:${e.planEndDate}">${e.subject}</p>\n            </div>\n            `)}))}(l),a(l),document.querySelectorAll(".js-header__button").forEach((t=>{t.addEventListener("click",(()=>{document.querySelectorAll(".cell").forEach((e=>{e.getAttribute("data-date")===d&&e.classList.add("today")})),s(l,e),a(l)}))})),t.forEach((e=>{e.getAttribute("data-date")===d&&e.classList.add("today")}))})(t)}()})();