(()=>{"use strict";function e(e,t,a){const n=new Date,r=document.querySelector(".month"),s=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];0!==a&&n.setDate((new Date).getDate()+a),document.querySelectorAll(".calendar__item").forEach((e=>e.remove()));for(let e=(n.setDate(n.getDate()-n.getDay()+1),Date.parse(n));e<=(n.setDate(n.getDate()-n.getDay()+(n.getDay()?7:0)),Date.parse(n));e+=864e5)t.innerHTML+=`\n      <div class="calendar__item weekdays__${new Date(e).getDay()}">\n                  <h4 class = "weekdays__item">${s[new Date(e).getDay()]}</h4>\n                  <h4 class="calendar__date">${new Date(e).toLocaleDateString().slice(0,5)}</h4>\n                  <div class="calendar__user-fields">\n                  </div>\n              </div>\n      `,r.innerHTML=`<h3>${new Date(e).toLocaleString("en",{month:"long"})}</h3>`;const d=document.querySelectorAll(".calendar__user-fields");Array.from(d).map((t=>{let a=1;for(;a<=e;)t.innerHTML+=`<p data-count=${a} data-date=${t.previousElementSibling.innerHTML} class = 'date-${t.previousElementSibling.innerHTML} cell cell--${a++} drop'></p>`;t.setAttribute("data-date",`${t.previousElementSibling.innerHTML}`)}))}const t=document.querySelector(".backlog__content"),a=async e=>{const a=document.querySelectorAll(".cell"),n=await(async e=>{let t=await fetch("https://varankin_dev.elma365.ru/api/extensions/2a38760e-083a-4dd0-aebc-78b570bfd3c7/script/tasks");return await t.json()})(),r=[];n.map((n=>{if(null===n.executor)t.innerHTML+=`\n            <div class="task__element" draggable="true" data-id="${n.id}">\n                <p class="task__description"  data-tooltip="Start:${n.planStartDate} Deadline:${n.planEndDate}">Task:${n.subject}</p>\n            </div>\n            `;else{let t=n.planEndDate.replace(/-/gi,".").slice(5,10),r=t.slice(3,5)+"."+t.slice(0,2);for(let t=0;t<e.length;t++)e[t].id===n.executor&&a.forEach((a=>{if(a.getAttribute("data-date")===r&&+a.getAttribute("data-count")===e[t].id){const e=document.createElement("div");e.setAttribute("draggable","true"),e.setAttribute("data-id",`${n.id}`),e.classList.add("task__element"),a.appendChild(e),e.innerHTML+=`<p class="task__description"   data-tooltip="Start:${n.planStartDate} Deadline:${n.planEndDate}">${n.subject}</p>`}}))}r.push(n)})),function(e){const t=document.querySelectorAll(".task__element"),a=document.querySelectorAll(".cell"),n=document.querySelectorAll(".users__item");let r=null,s=null;function d(e){e.dataTransfer.setData("dragItem",this.dataset.id),r=this,setTimeout((()=>{this.classList.add("hide")}),0)}function i(){this.classList.remove("hide"),r=null}function l(e){e.preventDefault()}function c(e){e.preventDefault(),this.classList.add("hovered"),s=this}function o(){this.classList.remove("hovered"),s=this}function u(){}function m(){this.append(r),this.classList.remove("hovered")}function v(t){const a=this.getAttribute("data-user-id");t.dataTransfer.getData("dragItem");for(let t=0;t<e.length;t++){let t=e[a].planEndDate.replace(/-/gi,".").slice(5,10),n=t.slice(3,5)+"."+t.slice(0,2);document.querySelector(`[data-date='${n}']`).querySelector(`[data-count='${a}']`).append(r)}this.classList.remove("hovered")}n.forEach((e=>{e.addEventListener("dragover",l),e.addEventListener("dragenter",c),e.addEventListener("dragleave",o),e.addEventListener("drop",v)})),a.forEach((e=>{e.addEventListener("dragover",l),e.addEventListener("dragenter",c),e.addEventListener("dragleave",o),e.addEventListener("drop",m)})),t.forEach((e=>{e.addEventListener("dragstart",d),e.addEventListener("dragend",i),e.addEventListener("drag",u),e.addEventListener("dragenter",(()=>{r!==s&&(s=e)})),e.addEventListener("dragleave",(()=>{s=null}))}))}(r)};let n=0;const r=document.querySelector(".users"),s=document.querySelector(".calendar__container");!async function(){const t=(await async function(){try{let e=await fetch("https://varankin_dev.elma365.ru/api/extensions/2a38760e-083a-4dd0-aebc-78b570bfd3c7/script/users");return await e.json()}catch(e){console.error(e)}}()).map((e=>(r.innerHTML+=`\n                <div class="users__item" data-user-id= ${e.id}>\n                            <h4 class="users__title" >${e.surname} ${e.firstName}</h4>\n                        </div>\n                `,{id:e.id,surname:e.surname,name:e.firstName})));console.log(t),function(t,a){document.getElementById("nextButton").addEventListener("click",(()=>{n+=7,e(t,a,n)})),document.getElementById("backButton").addEventListener("click",(()=>{n-=7,e(t,a,n)}))}(t.length,s),e(t.length,s,n),a(t)}()})();